import{r as t,o,c as l,a as n,b as s,w as i,F as u,e as p,d as a}from"./app.dd8de508.js";import{_ as r}from"./plugin-vue_export-helper.21dcd24c.js";const k={},d=p('<h1 id="day26-springboot-\u5FAE\u4FE1oauth\u63A5\u53E3\u96C6\u6210" tabindex="-1"><a class="header-anchor" href="#day26-springboot-\u5FAE\u4FE1oauth\u63A5\u53E3\u96C6\u6210" aria-hidden="true">#</a> Day26\uFF1ASpringBoot \u5FAE\u4FE1OAuth\u63A5\u53E3\u96C6\u6210</h1><h2 id="\u91CD\u70B9\u5185\u5BB9" tabindex="-1"><a class="header-anchor" href="#\u91CD\u70B9\u5185\u5BB9" aria-hidden="true">#</a> \u91CD\u70B9\u5185\u5BB9</h2><h3 id="\u7406\u89E3oauth2-0" tabindex="-1"><a class="header-anchor" href="#\u7406\u89E3oauth2-0" aria-hidden="true">#</a> \u7406\u89E3OAuth2.0</h3>',3),b=a("\u7406\u89E3OAuth2.0"),h=n("h3",{id:"java\u5FAE\u4FE1sdk-wxjava",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#java\u5FAE\u4FE1sdk-wxjava","aria-hidden":"true"},"#"),a(" Java\u5FAE\u4FE1SDK: WxJava")],-1),m=a("SKD\u4ED3\u5E93\uFF1A"),g={href:"https://github.com/Wechat-Group/WxJava",target:"_blank",rel:"noopener noreferrer"},x=a("https://github.com/Wechat-Group/WxJava"),v=a("WIKI\uFF1A "),f={href:"https://github.com/wechat-group/WxJava/wiki",target:"_blank",rel:"noopener noreferrer"},_=a("https://github.com/wechat-group/WxJava/wiki"),w=p(`<h3 id="wxsdk-\u88C5\u914D" tabindex="-1"><a class="header-anchor" href="#wxsdk-\u88C5\u914D" aria-hidden="true">#</a> WxSDK \u88C5\u914D</h3><ul><li>\u589E\u52A0appId\u548CappSecret\u914D\u7F6E\u9879</li><li>\u5C01\u88C5<code>WxMpService Bean</code>\uFF0C\u5B9A\u4E49<code>WxMpDefaultConfigImpl</code></li></ul><p>\u6587\u4EF6\u4F4D\u7F6E: <code>src/main/java/com/bilitech/yilimusic/config/WeChatConfig.java</code></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>
<span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WeChatConfig</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;\${weixin.mp.app-id}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> appId<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;\${weixin.mp.app-secret}&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> appSecret<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token class-name">WxMpService</span> <span class="token function">wxMpService</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">WxMpService</span> wxMpService <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WxMpServiceImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">WxMpDefaultConfigImpl</span> config <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WxMpDefaultConfigImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        config<span class="token punctuation">.</span><span class="token function">setAppId</span><span class="token punctuation">(</span>appId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        config<span class="token punctuation">.</span><span class="token function">setSecret</span><span class="token punctuation">(</span>appSecret<span class="token punctuation">)</span><span class="token punctuation">;</span>
        wxMpService<span class="token punctuation">.</span><span class="token function">setWxMpConfigStorage</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> wxMpService<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h3 id="\u6388\u6743\u5730\u5740\u63A5\u53E3-weixin-auth-url" tabindex="-1"><a class="header-anchor" href="#\u6388\u6743\u5730\u5740\u63A5\u53E3-weixin-auth-url" aria-hidden="true">#</a> \u6388\u6743\u5730\u5740\u63A5\u53E3 <code>/weixin/auth_url</code></h3><p>\u589E\u52A0\u4E00\u4E2A\u6388\u6743\u5730\u5740\u751F\u6210\u63A5\u53E3\uFF0C\u8FD4\u56DE\u524D\u7AEF\u5FAE\u4FE1\u6388\u6743\u5730\u5740\uFF0C\u9700\u8981\u4F20\u5165\u6388\u6743\u6210\u529F\u540E\u8DF3\u8F6C\u7684<code>redirectUrl</code>\u53C2\u6570</p><p>\u6587\u4EF6\u4F4D\u7F6E\uFF1A <code>src/main/java/com/bilitech/yilimusic/controller/WeixinController.java</code></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/auth_url&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getAuthUrl</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathParam</span><span class="token punctuation">(</span><span class="token string">&quot;redirectUrl&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> redirectUrl<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> wxMpService<span class="token punctuation">.</span><span class="token function">getOAuth2Service</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">buildAuthorizationUrl</span><span class="token punctuation">(</span>
                redirectUrl<span class="token punctuation">,</span>
                <span class="token class-name">WxConsts<span class="token punctuation">.</span>OAuth2Scope</span><span class="token punctuation">.</span>SNSAPI_USERINFO<span class="token punctuation">,</span>
                <span class="token keyword">null</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

 
</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h3 id="\u8FD4\u56DE\u5FAE\u4FE1\u57FA\u672C\u7528\u6237\u4FE1\u606F\u63A5\u53E3-weixin-get-user-info" tabindex="-1"><a class="header-anchor" href="#\u8FD4\u56DE\u5FAE\u4FE1\u57FA\u672C\u7528\u6237\u4FE1\u606F\u63A5\u53E3-weixin-get-user-info" aria-hidden="true">#</a> \u8FD4\u56DE\u5FAE\u4FE1\u57FA\u672C\u7528\u6237\u4FE1\u606F\u63A5\u53E3 <code>/weixin/get_user_info</code></h3><ul><li><p>\u7B2C\u4E00\u6B65\u4E2D\uFF0C\u7528\u6237\u6388\u6743\u8FC7\u7684 <code>code</code> \u8FD4\u56DE <code>access_token</code> \u548C <code>refresh_token</code>\uFF0C\u8FD9\u4E00\u6B65\u9AA4\u53EF\u4EE5\u662F\u524D\u7AEF\u4E0D\u53EF\u89C1</p></li><li><p>\u83B7\u53D6 <code>access_token</code> \u540E\uFF0C\u76F4\u63A5\u83B7\u53D6\u7528\u6237\u57FA\u672C\u4FE1\u606F\uFF0C\u901A\u8FC7\u672C\u63A5\u53E3\u8FD4\u56DE\u3002</p></li></ul><p>\u6587\u4EF6\u4F4D\u7F6E\uFF1A <code>src/main/java/com/bilitech/yilimusic/controller/WeixinController.java</code></p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code>
    <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/get_user_info&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">WxOAuth2UserInfo</span> <span class="token function">getUserInfo</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathParam</span><span class="token punctuation">(</span><span class="token string">&quot;code&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> code<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">WxErrorException</span> <span class="token punctuation">{</span>
        <span class="token class-name">WxOAuth2AccessToken</span> wxOAuth2AccessToken <span class="token operator">=</span> wxMpService<span class="token punctuation">.</span><span class="token function">getOAuth2Service</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAccessToken</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> wxMpService<span class="token punctuation">.</span><span class="token function">getOAuth2Service</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getUserInfo</span><span class="token punctuation">(</span>wxOAuth2AccessToken<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h2 id="\u5F55\u64AD\u89C6\u9891" tabindex="-1"><a class="header-anchor" href="#\u5F55\u64AD\u89C6\u9891" aria-hidden="true">#</a> \u5F55\u64AD\u89C6\u9891</h2><div class="custom-container tip"><p class="custom-container-title">\u63D0\u793A</p><p>\u5F55\u64AD\u89C6\u9891\u9884\u8BA12\u67082\u65E5\u66F4\u65B0</p></div>`,14);function S(W,j){const c=t("RouterLink"),e=t("ExternalLinkIcon");return o(),l(u,null,[d,n("p",null,[s(c,{to:"/service/oauth2.html"},{default:i(()=>[b]),_:1})]),h,n("ul",null,[n("li",null,[m,n("a",g,[x,s(e)])]),n("li",null,[v,n("a",f,[_,s(e)])])]),w],64)}var I=r(k,[["render",S]]);export{I as default};
